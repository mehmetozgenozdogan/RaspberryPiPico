
# HC-05 Bluetooth Connection and write to OLED Screen driven SSD1306 using Raspberry Pi Pico + GUI Thread
# Date    : 11-05-2021
# Location: Ankara/Turkey
# Author  : memonet

from machine import Pin, I2C
from ssd1306 import SSD1306_I2C
import framebuf
import math
import utime
import time
import _thread

WIDTH  = 128   
HEIGHT = 64                                 

#Screen - 1
sda1=machine.Pin(2)
scl1=machine.Pin(3)
i2c1=machine.I2C(1,sda=sda1, scl=scl1, freq=100000)

oled1 = SSD1306_I2C(128, 64, i2c1)
wait_timer = 1
ReadBT = ""
uart0 = machine.UART(0,baudrate=9600,timeout_char = 100)
bUart0 = b''
#BeyazFon
TR = bytearray(b"\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf0\x00\x0f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xc0\x00\x03\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x00\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf8\x00\x07\xfe\x1f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf0\x00\x3f\xff\x8f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe0\x00\x7f\xff\xef\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe0\x01\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xc0\x03\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x80\x07\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x80\x0f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x0f\xff\xff\xff\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x1f\xff\xff\xff\xfc\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x1f\xff\xff\xff\xfc\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x3f\xff\xff\xff\xfc\x7f\xbf\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x3f\xff\xff\xff\xfc\x38\x7f\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x7f\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xfc\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xf0\x01\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\x80\x01\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xfc\x00\x03\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\x80\x01\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xf0\x01\xff\xff\xff\xff\xff\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xfc\x00\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x7f\xff\xff\xff\xfc\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x3f\xff\xff\xff\xfc\x38\x7f\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x3f\xff\xff\xff\xfc\x7f\xbf\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x1f\xff\xff\xff\xfc\x7f\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x1f\xff\xff\xff\xfc\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x0f\xff\xff\xff\xfd\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x80\x0f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x80\x07\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xc0\x03\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe0\x01\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xe0\x00\xff\xff\xe7\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf0\x00\x3f\xff\xcf\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf8\x00\x0f\xfe\x1f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x00\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xc0\x00\x03\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xf0\x00\x0f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xfe\x00\x7f\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff")
#SiyahFon
#TR = bytearray(b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xff\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\xff\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\xff\xff\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xff\xf8\x01\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xff\xc0\x00\x70\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\xff\x80\x00\x10\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xf8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xf0\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xe0\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\xe0\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\xc0\x00\x00\x00\x03\x80\x40\x00\x00\x00\x00\x00\x00\x00\x01\xff\xc0\x00\x00\x00\x03\xc7\x80\x00\x00\x00\x00\x00\x00\x00\x01\xff\x80\x00\x00\x00\x03\xff\x80\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x03\xff\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x0f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x7f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x03\xff\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x7f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x0f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x03\xff\x80\x00\x00\x00\x03\xff\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\x80\x00\x00\x00\x03\xff\x80\x00\x00\x00\x00\x00\x00\x00\x01\xff\xc0\x00\x00\x00\x03\xc7\x80\x00\x00\x00\x00\x00\x00\x00\x01\xff\xc0\x00\x00\x00\x03\x80\x40\x00\x00\x00\x00\x00\x00\x00\x01\xff\xe0\x00\x00\x00\x03\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xe0\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xf0\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x7f\xf8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\xfe\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1f\xff\x00\x00\x18\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xff\xc0\x00\x30\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\xff\xf0\x01\xe0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\xff\xff\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x3f\xff\xfc\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0f\xff\xf0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\xff\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00")
TR_frame = framebuf.FrameBuffer(TR, 128, 64, framebuf.MONO_HLSB)

def starting_animation():
    oled1.fill(0)
    oled1.blit(TR_frame, 0, 0)
    oled1.show()
    time.sleep(wait_timer*2)
    oled1.fill(0)
    oled1.blit(TR_frame, 0, 0)
    oled1.show()
    time.sleep(wait_timer*2)
    
def get_clock():
    tmp_clock = []
    time_now =(utime.localtime ())
    if len(str(time_now[3])) == 1:
        tmp_clock.append("0" + str(time_now[3]))
    else:
        tmp_clock.append(str(time_now[3]))
        
    if len(str(time_now[4])) == 1:
        tmp_clock.append("0" + str(time_now[4]))
    else:
        tmp_clock.append(str(time_now[4]))
        
    if len(str(time_now[5])) == 1:
        tmp_clock.append("0" + str(time_now[5]))
    else:
        tmp_clock.append(str(time_now[5]))
        
    return tmp_clock

print (get_clock())

def main_gui_thread():
    global ReadBT
    try:
        while True:
            tmp = ReadBT
            if "TEST" in str(tmp):
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("-*-*-*-*-*-*-*-*",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("-*-*-*-*-*-*-*-*",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("-*-*-*-*-*-*-*-*",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("-*-*-*-*-*-*-*-*",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("-*-*-*-*-*-*-*-*",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("-*-*-*-*-*-*-*-*",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("-*-*-*-*-*-*-*-*",0,10)
                oled1.text("   BLUETOOTH    ",0,20)
                oled1.text("   HC-05 DATA   ",0,36)
                oled1.text("-*-*-*-*-*-*-*-*",0,48)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer/4)
                time_now =get_clock()
                oled1.fill(0)
                oled1.text("----------------",0,0)
                oled1.text("ID - 00000000",5,10)
                oled1.text("---------------",5,16)
                oled1.text(" " + str(tmp),10,24)
                oled1.text("    " + str(time_now[0]) + ":" + str(time_now[1]) + ":" + str(time_now[2]) + "  ",0,50)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer)
            elif tmp == "":
                time_now =get_clock()
                #print (str(day))
                oled1.fill(0)
                oled1.text("----------------",0,0)
                #oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("   BLUETOOTH    ",0,24)
                oled1.text("   WAITING...   ",0,34)
                #oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("    " + str(time_now[0]) + ":" + str(time_now[1]) + ":" + str(time_now[2]) + "  ",0,50)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer)
            else:
                time_now = get_clock()
                #print (str(day))
                oled1.fill(0)
                oled1.text("----------------",0,0)
                #oled1.text("*-*-*-*-*-*-*-*-",0,10)
                oled1.text("    MEMONET     ",0,24)
                oled1.text("      WATCH     ",0,34)
                #oled1.text("*-*-*-*-*-*-*-*-",0,48)
                oled1.text("    " + str(time_now[0]) + ":" + str(time_now[1]) + ":" + str(time_now[2]) + "  ",0,50)
                oled1.text("----------------",0,60)
                oled1.show()
                time.sleep(wait_timer)
    except:
        time.sleep(wait_timer*5)
        main_gui_thread()
        

def ReadFromBT():
    global ReadBT
    try:
        while True:
            #uart0.init()
            if uart0.any():
                b0 = uart0.read()
                #bUart0 = bUart0 + b0
                ReadBT = str(b0.decode('utf-8'))
                print("BLUETOOTH RECEIVED: " + b0.decode('utf-8'))
                #uart0.deinit()

    except:
        time.sleep(5)
        ReadFromBT()
    

starting_animation()
time.sleep(1)
_thread.start_new_thread(main_gui_thread, ())
time.sleep(1)
ReadFromBT()
#_thread.start_new_thread(ReadFromBT, ())

